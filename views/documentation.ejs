<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %></title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <style>
    .endpoint {
      border-left: 4px solid #0d6efd;
      padding-left: 15px;
      margin-bottom: 30px;
    }
    .method {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 4px;
      font-weight: bold;
      margin-right: 10px;
    }
    .method.get { background: #28a745; color: white; }
    .method.post { background: #007bff; color: white; }
    .method.put { background: #ffc107; color: black; }
    .method.patch { background: #fd7e14; color: white; }
    .method.delete { background: #dc3545; color: white; }
    pre {
      background: #f5f5f5;
      padding: 15px;
      border-radius: 4px;
      border: 1px solid #ddd;
    }
    .toc {
      position: sticky;
      top: 20px;
    }
  </style>
</head>
<body>
  <%- include('partials/navbar') %>
  
  <div class="container mt-4">
    <%- include('partials/messages') %>
    
    <h1 class="mb-4"><i class="bi bi-book"></i> <%= title %></h1>

    <!-- Table des matières -->
    <div class="card mb-4">
      <div class="card-header bg-dark text-white">
        <h3 class="h5 mb-0"><i class="bi bi-list-ul"></i> Table des matières</h3>
      </div>
      <div class="card-body">
        <ol>
          <li><a href="#overview">Vue d'ensemble</a></li>
          <li><a href="#tutorial">Tutoriel</a></li>
          <li><a href="#examples">Exemples</a></li>
          <li><a href="#glossary">Glossaire</a></li>
          <li><a href="#endpoints">Référence des endpoints</a>
            <ul>
              <li><a href="#users-api">API Utilisateurs</a></li>
              <li><a href="#catways-api">API Catways</a></li>
              <li><a href="#reservations-api">API Réservations</a></li>
            </ul>
          </li>
        </ol>
      </div>
    </div>

    <!-- 1. VUE D'ENSEMBLE -->
    <div class="card mb-4" id="overview">
      <div class="card-header bg-primary text-white">
        <h2 class="h4 mb-0"><i class="bi bi-eye"></i> 1. Vue d'ensemble</h2>
      </div>
      <div class="card-body">
        <h5>Qu'est-ce que cette API ?</h5>
        <p>
          L'API REST de gestion du port de plaisance permet de gérer les emplacements de pontons (catways), 
          les utilisateurs du système et les réservations des bateaux. Cette API suit les principes REST 
          et retourne des données au format JSON.
        </p>
        
        <h5>Architecture</h5>
        <p>L'application est structurée selon le pattern MVC avec une couche de services :</p>
        <ul>
          <li><strong>Modèles</strong> : Définissent la structure des données (User, Catway, Reservation)</li>
          <li><strong>Services</strong> : Contiennent la logique métier (userService, catwayService, reservationService)</li>
          <li><strong>Routes</strong> : Gèrent les requêtes HTTP et appellent les services</li>
          <li><strong>Vues</strong> : Templates EJS pour l'interface web</li>
        </ul>

        <h5>Authentification</h5>
        <div class="alert alert-info">
          <i class="bi bi-info-circle"></i> <strong>Note :</strong> Vous devez être authentifié via une session 
          pour accéder aux endpoints de l'API. Connectez-vous d'abord via l'interface web.
        </div>

        <h5>Format des réponses</h5>
        <p>Toutes les réponses sont au format JSON et suivent cette structure :</p>
        <pre>{
  "success": true,  // ou false en cas d'erreur
  "message": "Message descriptif",
  "data": { ... }   // Données retournées (si applicable)
}</pre>

        <h5>Ressources principales</h5>
        <ul>
          <li><strong>/api/users</strong> : Gestion des utilisateurs</li>
          <li><strong>/api/catways</strong> : Gestion des pontons</li>
          <li><strong>/api/catways/:id/reservations</strong> : Gestion des réservations (sous-ressources des catways)</li>
        </ul>
      </div>
    </div>

    <!-- 2. TUTORIEL -->
    <div class="card mb-4" id="tutorial">
      <div class="card-header bg-success text-white">
        <h2 class="h4 mb-0"><i class="bi bi-mortarboard"></i> 2. Tutoriel - Premiers pas</h2>
      </div>
      <div class="card-body">
        <h5>Étape 1 : Authentification</h5>
        <p>Avant d'utiliser l'API, connectez-vous sur <a href="/" target="_blank">la page d'accueil</a> avec vos identifiants.</p>
        <pre>Email : admin@port.com
Mot de passe : admin123</pre>

        <h5>Étape 2 : Lister les catways existants</h5>
        <p>Pour voir tous les pontons disponibles, faites une requête GET :</p>
        <pre>fetch('/api/catways')
  .then(response => response.json())
  .then(data => console.log(data.data));</pre>

        <h5>Étape 3 : Créer un nouveau catway</h5>
        <p>Pour ajouter un nouveau ponton, envoyez une requête POST avec les données :</p>
        <pre>fetch('/api/catways', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    catwayNumber: 'A15',
    type: 'long',
    catwayState: 'Bon état'
  })
})
.then(response => response.json())
.then(data => console.log(data));</pre>

        <h5>Étape 4 : Créer une réservation pour ce catway</h5>
        <p>Les réservations sont liées aux catways. Utilisez l'ID du catway :</p>
        <pre>// Remplacez :catwayId par l'ID du catway
fetch('/api/catways/:catwayId/reservations', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    clientName: 'Jean Dupont',
    boatName: 'Vent d\'Ouest',
    checkIn: '2024-06-01',
    checkOut: '2024-06-10'
  })
})
.then(response => response.json())
.then(data => console.log(data));</pre>

        <h5>Étape 5 : Modifier partiellement un catway (PATCH)</h5>
        <p>Pour mettre à jour uniquement l'état d'un catway :</p>
        <pre>fetch('/api/catways/:id', {
  method: 'PATCH',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    catwayState: 'En maintenance'
  })
})
.then(response => response.json())
.then(data => console.log(data));</pre>
      </div>
    </div>

    <!-- 3. EXEMPLES -->
    <div class="card mb-4" id="examples">
      <div class="card-header bg-info text-white">
        <h2 class="h4 mb-0"><i class="bi bi-code-slash"></i> 3. Exemples de code</h2>
      </div>
      <div class="card-body">
        <h5>Exemple 1 : Obtenir un catway spécifique</h5>
        <pre>// Récupérer le catway avec ID 64abc123
fetch('/api/catways/64abc123')
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      console.log('Catway numéro:', data.data.catwayNumber);
      console.log('État:', data.data.catwayState);
    }
  });</pre>

        <h5>Exemple 2 : Mettre à jour un utilisateur</h5>
        <pre>fetch('/api/users/64abc456', {
  method: 'PUT',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    name: 'Marie Martin',
    email: 'marie.martin@email.com'
  })
})
.then(response => response.json())
.then(data => console.log(data.message));</pre>

        <h5>Exemple 3 : Supprimer une réservation</h5>
        <pre>// Supprimer la réservation 64abc789 du catway 64abc123
fetch('/api/catways/64abc123/reservations/64abc789', {
  method: 'DELETE'
})
.then(response => response.json())
.then(data => {
  if (data.success) {
    console.log('Réservation supprimée avec succès');
  }
});</pre>

        <h5>Exemple 4 : Lister toutes les réservations d'un catway</h5>
        <pre>fetch('/api/catways/64abc123/reservations')
  .then(response => response.json())
  .then(data => {
    console.log('Nombre de réservations:', data.data.length);
    data.data.forEach(res => {
      console.log(`${res.clientName} - ${res.boatName}`);
    });
  });</pre>

        <h5>Exemple 5 : Gestion d'erreurs</h5>
        <pre>fetch('/api/catways/id-invalide')
  .then(response => response.json())
  .then(data => {
    if (!data.success) {
      console.error('Erreur:', data.message);
    }
  })
  .catch(error => console.error('Erreur réseau:', error));</pre>
      </div>
    </div>

    <!-- 4. GLOSSAIRE -->
    <div class="card mb-4" id="glossary">
      <div class="card-header bg-warning">
        <h2 class="h4 mb-0"><i class="bi bi-book-half"></i> 4. Glossaire</h2>
      </div>
      <div class="card-body">
        <dl class="row">
          <dt class="col-sm-3">API REST</dt>
          <dd class="col-sm-9">Interface de programmation respectant les principes REST (Representational State Transfer) permettant d'interagir avec l'application via HTTP.</dd>

          <dt class="col-sm-3">Catway</dt>
          <dd class="col-sm-9">Ponton d'amarrage pour bateaux dans un port de plaisance. Identifié par un numéro unique (ex: A12).</dd>

          <dt class="col-sm-3">Endpoint</dt>
          <dd class="col-sm-9">URL spécifique de l'API permettant d'effectuer une opération (ex: /api/catways).</dd>

          <dt class="col-sm-3">CRUD</dt>
          <dd class="col-sm-9">Create, Read, Update, Delete - Les 4 opérations de base sur les données.</dd>

          <dt class="col-sm-3">JSON</dt>
          <dd class="col-sm-9">JavaScript Object Notation - Format d'échange de données structurées.</dd>

          <dt class="col-sm-3">Middleware</dt>
          <dd class="col-sm-9">Fonction intermédiaire qui s'exécute entre la réception de la requête et l'envoi de la réponse (ex: authentification).</dd>

          <dt class="col-sm-3">Service Layer</dt>
          <dd class="col-sm-9">Couche de l'application contenant la logique métier, séparée des routes et des modèles.</dd>

          <dt class="col-sm-3">Sous-ressource</dt>
          <dd class="col-sm-9">Ressource dépendante d'une autre ressource. Les réservations sont des sous-ressources des catways.</dd>

          <dt class="col-sm-3">PUT vs PATCH</dt>
          <dd class="col-sm-9">PUT remplace complètement la ressource, PATCH modifie uniquement les champs fournis.</dd>

          <dt class="col-sm-3">Code de statut HTTP</dt>
          <dd class="col-sm-9">Nombre à 3 chiffres indiquant le résultat de la requête (200 = succès, 404 = non trouvé, 500 = erreur serveur).</dd>
        </dl>
      </div>
    </div>

    <hr class="my-5" id="endpoints">
    <h2 class="text-center mb-4">Référence complète des endpoints</h2>

    <!-- Utilisateurs -->
    <div class="card mb-4" id="users-api">
      <div class="card-header bg-dark text-white">
        <h2 class="h4 mb-0"><i class="bi bi-people"></i> API Utilisateurs</h2>
      </div>
      <div class="card-body">
        <p>Gestion des utilisateurs du système.</p>

        <!-- Créer un utilisateur -->
        <div class="endpoint">
          <h5>
            <span class="method post">POST</span>
            <code>/api/users</code>
          </h5>
          <p>Créer un nouvel utilisateur</p>
          <h6>Corps de la requête :</h6>
          <pre>{
  "name": "Jean Dupont",
  "email": "jean.dupont@example.com",
  "password": "motdepasse123"
}</pre>
          <h6>Réponse réussie (201) :</h6>
          <pre>{
  "success": true,
  "message": "Utilisateur créé avec succès",
  "data": {
    "_id": "64abc123...",
    "name": "Jean Dupont",
    "email": "jean.dupont@example.com",
    "createdAt": "2024-02-11T10:30:00.000Z"
  }
}</pre>
        </div>

        <!-- Lister les utilisateurs -->
        <div class="endpoint">
          <h5>
            <span class="method get">GET</span>
            <code>/api/users</code>
          </h5>
          <p>Récupérer tous les utilisateurs</p>
          <h6>Réponse réussie (200) :</h6>
          <pre>{
  "success": true,
  "count": 2,
  "data": [...]
}</pre>
        </div>

        <!-- Récupérer un utilisateur -->
        <div class="endpoint">
          <h5>
            <span class="method get">GET</span>
            <code>/api/users/:id</code>
          </h5>
          <p>Récupérer un utilisateur par son ID</p>
        </div>

        <!-- Mettre à jour un utilisateur -->
        <div class="endpoint">
          <h5>
            <span class="method put">PUT</span>
            <code>/api/users/:id</code>
          </h5>
          <p>Mettre à jour un utilisateur</p>
          <h6>Corps de la requête (tous les champs sont optionnels) :</h6>
          <pre>{
  "name": "Jean Dupont",
  "email": "nouveau.email@example.com",
  "password": "nouveaumotdepasse"
}</pre>
        </div>

        <!-- Supprimer un utilisateur -->
        <div class="endpoint">
          <h5>
            <span class="method delete">DELETE</span>
            <code>/api/users/:id</code>
          </h5>
          <p>Supprimer un utilisateur</p>
        </div>
      </div>
    </div>

    <!-- Catways -->
    <div class="card mb-4" id="catways-api">
      <div class="card-header bg-primary text-white">
        <h2 class="h4 mb-0"><i class="bi bi-list"></i> API Catways</h2>
      </div>
      <div class="card-body">
        <p>Gestion des emplacements de catways (pontons).</p>

        <!-- Créer un catway -->
        <div class="endpoint">
          <h5>
            <span class="method post">POST</span>
            <code>/api/catways</code>
          </h5>
          <p>Créer un nouveau catway</p>
          <h6>Corps de la requête :</h6>
          <pre>{
  "catwayNumber": "A12",
  "type": "long",
  "catwayState": "Bon état"
}</pre>
          <h6>Types acceptés :</h6>
          <ul>
            <li><code>long</code> - Catway long</li>
            <li><code>short</code> - Catway court</li>
          </ul>
          <h6>Réponse réussie (201) :</h6>
          <pre>{
  "success": true,
  "message": "Catway créé avec succès",
  "data": {
    "_id": "64abc456...",
    "catwayNumber": "A12",
    "type": "long",
    "catwayState": "Bon état",
    "createdAt": "2024-02-11T10:30:00.000Z"
  }
}</pre>
        </div>

        <!-- Lister les catways -->
        <div class="endpoint">
          <h5>
            <span class="method get">GET</span>
            <code>/api/catways</code>
          </h5>
          <p>Récupérer tous les catways</p>
        </div>

        <!-- Récupérer un catway -->
        <div class="endpoint">
          <h5>
            <span class="method get">GET</span>
            <code>/api/catways/:id</code>
          </h5>
          <p>Récupérer un catway par son ID</p>
        </div>

        <!-- Mettre à jour un catway -->
        <div class="endpoint">
          <h5>
            <span class="method put">PUT</span>
            <code>/api/catways/:id</code>
          </h5>
          <p>Mettre à jour un catway (tous les champs)</p>
          <h6>Corps de la requête :</h6>
          <pre>{
  "catwayNumber": "A12",
  "type": "long",
  "catwayState": "En maintenance"
}</pre>
        </div>

        <!-- PATCH un catway (NOUVEAU) -->
        <div class="endpoint">
          <h5>
            <span class="method patch">PATCH</span>
            <code>/api/catways/:id</code>
          </h5>
          <p>Modifier partiellement un catway (seulement les champs fournis)</p>
          <h6>Corps de la requête (tous les champs sont optionnels) :</h6>
          <pre>{
  "catwayState": "En maintenance"
}</pre>
          <h6>Différence avec PUT :</h6>
          <p>PATCH permet de ne modifier qu'un seul champ sans avoir à renvoyer tous les autres. PUT nécessite tous les champs.</p>
        </div>

        <!-- Supprimer un catway -->
        <div class="endpoint">
          <h5>
            <span class="method delete">DELETE</span>
            <code>/api/catways/:id</code>
          </h5>
          <p>Supprimer un catway</p>
        </div>

        <hr class="my-4">
        <h3><i class="bi bi-calendar-check"></i> Sous-ressources : Réservations du catway</h3>
        <p>Les réservations sont gérées comme sous-ressources des catways. Toutes les routes commencent par <code>/api/catways/:id/reservations</code></p>

        <!-- Créer une réservation pour un catway -->
        <div class="endpoint">
          <h5>
            <span class="method post">POST</span>
            <code>/api/catways/:id/reservations</code>
          </h5>
          <p>Créer une nouvelle réservation pour un catway</p>
          <h6>Corps de la requête :</h6>
          <pre>{
  "clientName": "Marie Martin",
  "boatName": "Sea Breeze",
  "checkIn": "2024-03-15",
  "checkOut": "2024-03-20"
}</pre>
          <p><em>Note : Le numéro de catway est automatiquement déduit de l'ID dans l'URL</em></p>
        </div>

        <!-- Lister les réservations d'un catway -->
        <div class="endpoint">
          <h5>
            <span class="method get">GET</span>
            <code>/api/catways/:id/reservations</code>
          </h5>
          <p>Récupérer toutes les réservations d'un catway spécifique</p>
        </div>

        <!-- Récupérer une réservation spécifique -->
        <div class="endpoint">
          <h5>
            <span class="method get">GET</span>
            <code>/api/catways/:id/reservations/:idReservation</code>
          </h5>
          <p>Récupérer une réservation spécifique d'un catway</p>
        </div>

        <!-- Supprimer une réservation d'un catway -->
        <div class="endpoint">
          <h5>
            <span class="method delete">DELETE</span>
            <code>/api/catways/:id/reservations/:idReservation</code>
          </h5>
          <p>Supprimer une réservation d'un catway</p>
        </div>
      </div>
    </div>

    <!-- Réservations (routes standalone - legacy) -->
    <div class="card mb-4" id="reservations-api">
      <div class="card-header bg-success text-white">
        <h2 class="h4 mb-0"><i class="bi bi-calendar-check"></i> API Réservations (Routes standalone)</h2>
      </div>
      <div class="card-body">
        <div class="alert alert-warning">
          <i class="bi bi-exclamation-triangle"></i> <strong>Note :</strong> 
          Ces routes sont maintenues pour compatibilité. Il est recommandé d'utiliser les 
          <a href="#catways-api" class="alert-link">sous-ressources des catways</a> pour gérer les réservations.
        </div>
        <p>Gestion des réservations de catways (accès direct).</p>

        <!-- Créer une réservation -->
        <div class="endpoint">
          <h5>
            <span class="method post">POST</span>
            <code>/api/reservations</code>
          </h5>
          <p>Créer une nouvelle réservation</p>
          <h6>Corps de la requête :</h6>
          <pre>{
  "catwayNumber": "A12",
  "clientName": "Marie Martin",
  "boatName": "Sea Breeze",
  "checkIn": "2024-03-15",
  "checkOut": "2024-03-20"
}</pre>
          <h6>Réponse réussie (201) :</h6>
          <pre>{
  "success": true,
  "message": "Réservation créée avec succès",
  "data": {
    "_id": "64abc789...",
    "catwayNumber": "A12",
    "clientName": "Marie Martin",
    "boatName": "Sea Breeze",
    "checkIn": "2024-03-15T00:00:00.000Z",
    "checkOut": "2024-03-20T00:00:00.000Z",
    "createdAt": "2024-02-11T10:30:00.000Z"
  }
}</pre>
        </div>

        <!-- Lister les réservations -->
        <div class="endpoint">
          <h5>
            <span class="method get">GET</span>
            <code>/api/reservations</code>
          </h5>
          <p>Récupérer toutes les réservations</p>
        </div>

        <!-- Récupérer une réservation -->
        <div class="endpoint">
          <h5>
            <span class="method get">GET</span>
            <code>/api/reservations/:id</code>
          </h5>
          <p>Récupérer une réservation par son ID</p>
        </div>

        <!-- Mettre à jour une réservation -->
        <div class="endpoint">
          <h5>
            <span class="method put">PUT</span>
            <code>/api/reservations/:id</code>
          </h5>
          <p>Mettre à jour une réservation</p>
          <h6>Corps de la requête (tous les champs sont optionnels) :</h6>
          <pre>{
  "catwayNumber": "A12",
  "clientName": "Marie Martin",
  "boatName": "Sea Breeze II",
  "checkIn": "2024-03-15",
  "checkOut": "2024-03-22"
}</pre>
        </div>

        <!-- Supprimer une réservation -->
        <div class="endpoint">
          <h5>
            <span class="method delete">DELETE</span>
            <code>/api/reservations/:id</code>
          </h5>
          <p>Supprimer une réservation</p>
        </div>
      </div>
    </div>

    <!-- Codes d'erreur -->
    <div class="card mb-4">
      <div class="card-header bg-danger text-white">
        <h2 class="h4 mb-0"><i class="bi bi-exclamation-triangle"></i> Codes de statut HTTP</h2>
      </div>
      <div class="card-body">
        <table class="table">
          <thead>
            <tr>
              <th>Code</th>
              <th>Description</th>
              <th>Quand l'utiliser</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>200</code></td>
              <td>Requête réussie</td>
              <td>Pour les requêtes GET, PUT, PATCH réussies</td>
            </tr>
            <tr>
              <td><code>201</code></td>
              <td>Ressource créée avec succès</td>
              <td>Pour les requêtes POST réussies</td>
            </tr>
            <tr>
              <td><code>400</code></td>
              <td>Requête invalide</td>
              <td>Données manquantes ou incorrectes</td>
            </tr>
            <tr>
              <td><code>401</code></td>
              <td>Non authentifié</td>
              <td>Session expirée ou utilisateur non connecté</td>
            </tr>
            <tr>
              <td><code>404</code></td>
              <td>Ressource non trouvée</td>
              <td>ID invalide ou ressource supprimée</td>
            </tr>
            <tr>
              <td><code>500</code></td>
              <td>Erreur serveur</td>
              <td>Erreur inattendue côté serveur</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
